<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Coding week18 9/30-10/06 | Zebin Huang | JdeRobot x GSoC2024 </title> <meta name="author" content="Zebin Huang"> <meta name="description" content="Zebin Huang | JdeRobot x GSoC2024 "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/gsoc2024-ZebinHuang/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/gsoc2024-ZebinHuang/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/gsoc2024-ZebinHuang/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/gsoc2024-ZebinHuang/assets/img/logo.png?a3cac8c2613225704682d343b37ffd84"> <link rel="stylesheet" href="/gsoc2024-ZebinHuang/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://theroboticsclub.github.io/gsoc2024-ZebinHuang/blog/2024/week18/"> <script src="/gsoc2024-ZebinHuang/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/gsoc2024-ZebinHuang/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/gsoc2024-ZebinHuang/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/gsoc2024-ZebinHuang/assets/js/distillpub/template.v2.js"></script> <script src="/gsoc2024-ZebinHuang/assets/js/distillpub/transforms.v2.js"></script> <script src="/gsoc2024-ZebinHuang/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Coding week18 9/30-10/06",
            "description": "",
            "published": "September 30, 2024",
            "authors": [
              
              {
                "author": "Zebin Huang",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Edinburgh Centre for Robotics",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/gsoc2024-ZebinHuang/"> Zebin Huang | JdeRobot x GSoC2024 </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-ZebinHuang/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-ZebinHuang/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-ZebinHuang/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Coding week18 9/30-10/06</h1> <p></p> </d-title> <d-byline></d-byline> <d-article> <p>In recent discussions, we realize that the need for a distance-aware method to enhance the precision of autonomous driving actions within the CARLA simulator. Our previous control models lack a mechanism for dynamically adjusting actions based on the actual distance to objects or specific targets. By introducing a distance-aware approach, control actions can be fine-tuned by calculating the difference between initial and final positions. This capability is crucial for maneuvers like U-turns, where precise control over trajectory and stopping distances significantly impacts performance.</p> <p>In this week, LLMs are being explored for their potential to interpret natural language instructions, especially those that include ambiguous distance-related commands, such as “move a bit closer” or “stop at a safe distance.” By parsing these instructions, LLMs can generate actionable, distance-specific commands for the control module.</p> <p>In terms of validation, a proof-of-concept for the distance measurement within a simplified CARLA scenario was developed. This demo will test the accuracy by measuring how well the system calculates and responds to varying distances in real-time.</p> <h3 id="new-prompt-for-distance-instructions">New Prompt for Distance Instructions</h3> <p>In autonomous driving, instructions need to be clear, concise, and actionable. The new prompt system generates driving instructions by incorporating the specific action and distance parameters. Here’s how it works:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_instruction_prompt</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Generate a prompt for the OpenAI API to create a driving instruction for a given action.
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
    You are generating driving instructions for an autonomous vehicle system. Each instruction should have a clear structure and follow these specific guidelines:

    1. The instruction should contain the following fields:
        - </span><span class="sh">'</span><span class="s">Instruction</span><span class="sh">'</span><span class="s">: A short, human-readable driving instruction that includes the action </span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="s">. The instruction should also specify the distance or condition.
        - </span><span class="sh">'</span><span class="s">Action</span><span class="sh">'</span><span class="s">: This should be exactly one of the following: </span><span class="sh">'</span><span class="s">Right</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">Left</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">Straight</span><span class="sh">'</span><span class="s">, or </span><span class="sh">'</span><span class="s">LaneFollow</span><span class="sh">'</span><span class="s">. For this instruction, it should be </span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="s">.
        - </span><span class="sh">'</span><span class="s">Distance</span><span class="sh">'</span><span class="s">: A distance measurement in meters (e.g., </span><span class="sh">'</span><span class="s">500 meters</span><span class="sh">'</span><span class="s">) or kilometers (e.g., </span><span class="sh">'</span><span class="s">1.2 kilometers</span><span class="sh">'</span><span class="s">). This should reflect how far the action applies or when the next instruction should be executed.

    2. The </span><span class="sh">'</span><span class="s">Instruction</span><span class="sh">'</span><span class="s"> should be realistic and concise, similar to how a navigation system provides directions. Here are three detailed examples:
        - Example 1:
          - Instruction: </span><span class="sh">"</span><span class="s">Turn right at the next intersection and continue for 500 meters.</span><span class="sh">"</span><span class="s">
          - Action: </span><span class="sh">"</span><span class="s">Right</span><span class="sh">"</span><span class="s">
          - Distance: </span><span class="sh">"</span><span class="s">500 meters</span><span class="sh">"</span><span class="s">
        - Example 2:
          - Instruction: </span><span class="sh">"</span><span class="s">Proceed straight for 1.5 kilometers until you reach the gas station.</span><span class="sh">"</span><span class="s">
          - Action: </span><span class="sh">"</span><span class="s">Straight</span><span class="sh">"</span><span class="s">
          - Distance: </span><span class="sh">"</span><span class="s">1.5 kilometers</span><span class="sh">"</span><span class="s">
        - Example 3:
          - Instruction: </span><span class="sh">"</span><span class="s">Follow the lane for 3 kilometers and exit at the next junction.</span><span class="sh">"</span><span class="s">
          - Action: </span><span class="sh">"</span><span class="s">LaneFollow</span><span class="sh">"</span><span class="s">
          - Distance: </span><span class="sh">"</span><span class="s">3 kilometers</span><span class="sh">"</span><span class="s">

    3. Ensure the action </span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="s"> is embedded naturally in the </span><span class="sh">'</span><span class="s">Instruction</span><span class="sh">'</span><span class="s">, and that it specifies when or where the action should occur.

    4. The generated JSON output should have the following structure:
    Instruction

    Based on this structure, generate a driving instruction for the action </span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="s">.
    </span><span class="sh">"""</span>

</code></pre></div></div> <p>For example, an output could be:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Instruction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Follow the lane for 2 kilometers until you reach the gas station."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LaneFollow"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Distance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2 kilometers"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>We validated smooth action transitions in Town01 using PID control for proof of concept. As shown in the following video.</p> <iframe width="700" height="500" src="https://www.youtube.com/embed/GvBChwSAYfk" title="U-turn Town 01" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> <h3 id="distance-measurement">Distance Measurement</h3> <p>The system includes a function to measure the distance traveled, which is essential for determining when to transition from one action to another. The function uses the Euclidean distance formula to calculate the distance between two points:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_dist</span><span class="p">(</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">((</span><span class="n">loc2</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">loc1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">loc2</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">loc1</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div> <ul> <li> <strong>Explanation</strong>: The <code class="language-plaintext highlighter-rouge">find_dist</code> function computes the distance in CARLA’s 2D plane (X, Y) between the starting position (<code class="language-plaintext highlighter-rouge">loc1</code>) and the vehicle’s current position (<code class="language-plaintext highlighter-rouge">loc2</code>).</li> <li> <strong>Usage</strong>: The system calculates the <code class="language-plaintext highlighter-rouge">dist_travelled</code> by comparing the start and current locations, adjusting the vehicle’s controls based on whether the required distance has been reached.</li> </ul> <p>Example application:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_location</span> <span class="o">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="nf">get_location</span><span class="p">()</span>
<span class="n">current_location</span> <span class="o">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="nf">get_location</span><span class="p">()</span>
<span class="n">dist_travelled</span> <span class="o">=</span> <span class="nf">find_dist</span><span class="p">(</span><span class="n">start_location</span><span class="p">,</span> <span class="n">current_location</span><span class="p">)</span> <span class="c1"># Calculate the distance traveled
</span></code></pre></div></div> <p>In the <code class="language-plaintext highlighter-rouge">drive_forward</code> function, this logic ensures the vehicle halts upon reaching the specified distance:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">dist_travelled</span> <span class="o">&gt;=</span> <span class="n">distance</span><span class="p">:</span>
    <span class="n">control</span> <span class="o">=</span> <span class="n">carla</span><span class="p">.</span><span class="nc">VehicleControl</span><span class="p">(</span><span class="n">throttle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">brake</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Stop the vehicle
</span>    <span class="n">vehicle</span><span class="p">.</span><span class="nf">apply_control</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
    <span class="k">break</span>
</code></pre></div></div> <p>In the Town01 map, we tested whether the real-time distance measurement module was functioning correctly. A video demonstration is provided below.</p> <iframe width="700" height="500" src="https://www.youtube.com/embed/5Goq_FYiyeU" title="Distance Measurement 1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/gsoc2024-ZebinHuang/assets/bibliography/posts.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zebin Huang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/gsoc2024-ZebinHuang/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>